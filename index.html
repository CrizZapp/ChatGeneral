<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <style>
        body { background: #0b141a; color: white; font-family: sans-serif; text-align: center; }
        .hidden { display: none !important; }
        input { padding: 12px; border-radius: 5px; border: none; width: 80%; margin: 10px; }
        button { padding: 12px; background: #00a884; color: white; border: none; width: 80%; border-radius: 5px; font-weight: bold; }
        #messages { height: 70vh; overflow-y: auto; text-align: left; padding: 10px; }
        .msg { background: #202c33; padding: 8px; border-radius: 8px; margin-bottom: 8px; width: fit-content; }
    </style>
</head>
<body>

    <div id="pantalla-inicio">
        <h2>¿Cómo te llamas?</h2>
        <input type="text" id="nombre-input" placeholder="Tu nombre...">
        <button onclick="entrarAlChat()">ENTRAR</button>
    </div>

    <div id="pantalla-chat" class="hidden">
        <div id="messages"></div>
        <input type="text" id="mensaje-input" placeholder="Escribe algo...">
        <button onclick="enviarMensaje()" style="width: 50px;">></button>
    </div>

    <button onclick="activarAdmin()" style="position:fixed; bottom:5px; left:5px; opacity:0.1; background:none; border:none; color:white;">Admin</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let miNombre = "";
        let miPassAdmin = "";

        function entrarAlChat() {
            const nick = document.getElementById('nombre-input').value;
            if (nick.trim() !== "") {
                miNombre = nick;
                document.getElementById('pantalla-inicio').classList.add('hidden');
                document.getElementById('pantalla-chat').classList.remove('hidden');
                console.log("Entrando como: " + miNombre);
            } else {
                alert("Poné un nombre, che.");
            }
        }

        function enviarMensaje() {
            const caja = document.getElementById('mensaje-input');
            const texto = caja.value.trim();
            if (texto !== "") {
                socket.emit('chat message', { user: miNombre, text: texto });
                caja.value = "";
            }
        }

        socket.on('chat message', (data) => {
            const div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = `<b>${data.user}:</b> ${data.text}`;
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        });

        function activarAdmin() {
            const p = prompt("Código:");
            if(p === "admin777") { miPassAdmin = p; alert("Admin OK"); }
        }
    </script>
</body>
</html>
