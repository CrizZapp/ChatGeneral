<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Privado - Admin Mode</title>
    <style>
        * { box-sizing: border-box; }
        body { background: #0b141a; color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Pantalla de Inicio */
        #login { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0b141a; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        #login input { padding: 15px; border-radius: 10px; border: none; width: 80%; max-width: 300px; background: #2a3942; color: white; margin-bottom: 10px; }
        #login button { padding: 15px; width: 80%; max-width: 300px; border-radius: 10px; border: none; background: #00a884; color: white; font-weight: bold; cursor: pointer; }

        /* Área de Chat */
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { background: #202c33; padding: 10px; border-radius: 10px; width: fit-content; max-width: 85%; position: relative; word-wrap: break-word; }
        .msg b { color: #00a884; display: block; font-size: 0.85em; margin-bottom: 4px; }
        .msg img { max-width: 100%; border-radius: 8px; margin-top: 5px; display: block; }

        /* Barra de entrada */
        #input-area { background: #111b21; padding: 10px; display: flex; align-items: center; gap: 10px; }
        #input-area input { flex: 1; background: #2a3942; border: none; padding: 12px; border-radius: 8px; color: white; outline: none; }
        #input-area button { background: #00a884; border: none; color: white; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Botón Secreto Admin */
        #admin-btn { position: fixed; bottom: 5px; left: 5px; opacity: 0.1; background: none; border: none; color: white; font-size: 10px; cursor: pointer; }
        #admin-btn:hover { opacity: 0.5; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="login">
        <h2 style="color: #00a884;">Chat de la Banda</h2>
        <input type="text" id="username" placeholder="Tu nombre o apodo...">
        <button onclick="entrar()">ENTRAR AL CHAT</button>
    </div>

    <div id="messages"></div>

    <div id="input-area">
        <input type="text" id="txt" placeholder="Escribe un mensaje o pega link de imagen..." onkeypress="if(event.key==='Enter') enviar()">
        <button onclick="enviar()">></button>
    </div>

    <button id="admin-btn" onclick="activarAdmin()">CODIGO</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let miNombre = "";
        let miPassAdmin = "";

        function entrar() {
            const input = document.getElementById('username');
            if(input.value.trim() != "") {
                miNombre = input.value;
                document.getElementById('login').classList.add('hidden');
            }
        }

        function enviar() {
            const input = document.getElementById('txt');
            const mensaje = input.value.trim();
            
            if(!mensaje) return;

            // Lógica de Comandos de Admin
            if(mensaje.startsWith('/clear') && miPassAdmin === "admin777") {
                socket.emit('admin command', { key: miPassAdmin, action: 'clear' });
            } 
            else if(mensaje.startsWith('/ban ') && miPassAdmin === "admin777") {
                const objetivo = mensaje.replace('/ban ', '');
                socket.emit('admin command', { key: miPassAdmin, action: 'ban', target: objetivo });
            }
            else {
                // Envío normal de mensaje o imagen
                socket.emit('chat message', { user: miNombre, text: mensaje });
            }
            
            input.value = "";
        }

        function activarAdmin() {
            const pass = prompt("Introduce el código de acceso:");
            if(pass === "admin777") {
                miPassAdmin = pass;
                alert("MODO ADMIN: ACTIVO. Comandos: /clear , /ban Nombre");
            } else {
                alert("Código incorrecto.");
            }
        }

        socket.on('chat message', (data) => {
            const container = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = 'msg';

            // Detectar si el mensaje es un link de imagen (jpg, png, gif)
            const esImagen = data.text.match(/\.(jpeg|jpg|gif|png|webp)$/i);

            if(esImagen) {
                div.innerHTML = `<b>${data.user}</b><img src="${data.text}" alt="imagen">`;
            } else {
                div.innerHTML = `<b>${data.user}</b><span>${data.text}</span>`;
            }

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        });

        socket.on('admin control', (data) => {
            if(data.type === 'clear') {
                document.getElementById('messages').innerHTML = "<p style='color:gray; text-align:center;'>Chat limpiado por el admin</p>";
            }
            if(data.type === 'ban' && miNombre === data.target) {
                alert("Has sido baneado por el Admin.");
                window.location.href = "https://google.com"; // Lo echa a Google
            }
        });
    </script>
</body>
</html>
